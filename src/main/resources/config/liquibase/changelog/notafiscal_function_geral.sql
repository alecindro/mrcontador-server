CREATE OR REPLACE FUNCTION ${schema}.processa_notafiscalgeral("pPAR_CODIGO" bigint)
 RETURNS numeric
 LANGUAGE plpgsql
AS $function$
declare
  pPAR_CODIGO ALIAS for $1;
  vRETORNO NUMERIC;
  vQUANTIDADE NUMERIC;
  REC RECORD;

BEGIN 
  vRETORNO:= 0;  
  FOR REC IN
    SELECT id  FROM ${schema}.NOTAFISCAL  WHERE  TNO_CODIGO=0
    AND PARCEIRO_ID = pPAR_CODIGO AND PROCESSADO = FALSE  
  LOOP
   SELECT ${schema}.processa_notafiscal(REC.id) INTO vQUANTIDADE;
   vRETORNO:= vRETORNO + vQUANTIDADE; 
  END LOOP;
  RETURN COALESCE(vRETORNO ,0);
END;
$function$
;